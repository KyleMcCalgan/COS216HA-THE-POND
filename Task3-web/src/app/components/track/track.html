<div class="track-container">
  <!-- Header with back button -->
  <div class="track-header">
    <h2>Track Order {{ orderId }}</h2>
  </div>
  
  <!-- Drone state notification bar -->
  <div *ngIf="showStateMessage" class="state-bar" [ngClass]="getDroneStateClass()">
    <div class="state-bar-content">
      <span class="state-label">{{ getDroneStateText() }}</span>
      <span class="state-message">{{ stateMessage }}</span>
    </div>
  </div>
  
  <!-- Main content section -->
  <div *ngIf="orderDetails; else noOrder" class="track-content">
    <div class="content-grid">
      <!-- Left panel with order details -->
      <div class="details-panel">
        <div class="order-info-card">
          <h3>Order Information</h3>
          <div class="info-list">
            <div class="info-item">
              <span class="info-label">Customer:</span>
              <span class="info-value">{{ orderDetails.customer }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Products:</span>
              <span class="info-value">{{ orderDetails.products.join(', ') }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Destination:</span>
              <span class="info-value">{{ orderDetails.destination.latitude.toFixed(4) }}, {{ orderDetails.destination.longitude.toFixed(4) }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Drone ID:</span>
              <span class="info-value">{{ orderDetails.droneId }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Operation Center:</span>
              <span class="info-value">Hatfield, Pretoria</span>
            </div>
          </div>
        </div>
        
        <!-- Drone Status Card (New) -->
        <div class="drone-status-card">
          <h3>Drone Status</h3>
          <div class="info-list">
            <div class="info-item">
              <span class="info-label">Current State:</span>
              <span class="info-value state-badge" [ngClass]="getDroneStateClass()">{{ getDroneStateText() }}</span>
            </div>
            <div *ngIf="droneDetails" class="info-item">
              <span class="info-label">Battery:</span>
              <span class="info-value">
                <div class="battery-indicator">
                  <div class="battery-level" [style.width.%]="droneDetails.battery_level"></div>
                  {{ droneDetails.battery_level }}%
                </div>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Controls:</span>
              <span class="info-value">Use W, A, S, D keys to move the drone</span>
            </div>
          </div>
        </div>
        
        <div class="navigation-actions">
          <button (click)="returnToDispatched()" class="return-btn">Return to Drone Orders</button>
        </div>
      </div>
      
      <!-- Right panel with map -->
      <div class="map-panel">
        <div class="map-container" id="map"></div>
        <div class="map-legend">
          <div class="legend-item">
            <span class="legend-marker hq"></span>
            <span>Headquarters</span>
          </div>
          <div class="legend-item">
            <span class="legend-marker destination"></span>
            <span>Destination</span>
          </div>
          <div class="legend-item">
            <span class="legend-marker drone"></span>
            <span>Drone</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- No order found state -->
  <ng-template #noOrder>
    <div class="error-message">
      <div class="error-icon">!</div>
      <h3>Order Not Found</h3>
      <p>Order information could not be loaded or this order doesn't exist.</p>
      <button (click)="returnToDispatched()" class="return-btn">Return to Drone Orders</button>
    </div>
  </ng-template>
</div>